model Conversation {
    id            String    @id @default(uuid()) @db.Uuid
    creatorId       String    @db.Uuid
    friendId       String    @db.Uuid
    lastMessage   String?
    lastMessageAt DateTime?

    // save index
    user1LastReadIndex Int @default(0)
    user2LastReadIndex Int @default(0)

    socketId String @unique

    //total message
    totalMessage Int @default(0)

    createdAt DateTime @default(now())
    updateAt  DateTime @updatedAt

    // relation
    user1          User             @relation("user1Chats", fields: [creatorId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    user2          User             @relation("user2Chats", fields: [friendId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    privateMessage PrivateMessage[]

    @@unique([creatorId, friendId])
    @@index([creatorId])
    @@index([friendId])
    @@index([lastMessageAt])
    @@map("private_chats")
}

model PrivateMessage {
    id       String @id @default(uuid()) @db.Uuid
    content  String
    conversationId   String @db.Uuid

    senderId String @db.Uuid
    receiverId String @db.Uuid
    messageIndex Int

    replyToId String?          @db.Uuid
    replyTo   PrivateMessage?  @relation("MessageReply", fields: [replyToId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    replies   PrivateMessage[] @relation("MessageReply")

    createdAt DateTime @default(now())
    updateAt  DateTime @updatedAt

    // relation
    chat   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    sender User        @relation("SentMessage", fields: [senderId], references: [id], onDelete: Cascade, onUpdate: Cascade)

    @@unique([conversationId, messageIndex])
    @@index([conversationId, messageIndex])
    @@index([senderId])
    @@index([replyToId])
    @@map("private_messages")
}
