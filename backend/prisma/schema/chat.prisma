model Conversation {
  id             String           @map("id")              @id @default(uuid()) @db.Uuid
  conversationId String           @map("conversation_id") @unique @db.VarChar(100)
  isGroup        Boolean          @map("is_group")        @default(false)
  groupName      String?          @map("group_name")      @db.VarChar(255)

  createdAt      DateTime         @map("created_at")      @default(now()) @db.Timestamptz()
  updatedAt      DateTime         @map("updated_at")      @updatedAt @db.Timestamptz()
  deletedAt      DateTime?        @map("deleted_at")      @db.Timestamptz()

  //             relation
  user1Id        String           @map("user1_id")        @db.Uuid
  user1          User             @relation(name: "user1Chats", fields: [user1Id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  user2Id        String           @map("user2_id")        @db.Uuid
  user2          User             @relation(name: "user2Chats", fields: [user2Id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  messages       PrivateMessage[]

  lastMessageAt  DateTime                                 @updatedAt
  totalMessage   Int                                      @default(0)

  @@unique([user1Id, user2Id])
  @@index([conversationId])
  @@map("conversation")
}

model PrivateMessage {
  id             String       @map("id")              @id @default(uuid()) @db.Uuid
  content        String       @map("content")         @db.Text
  isRead         Boolean      @map("is_read")         @default(false)
  imageUrl       String?      @map("image_url")       @db.VarChar(500)
  replyToId      String?      @map("reply_to_id")     @db.Uuid

  createdAt      DateTime     @map("created_at")      @default(now()) @db.Timestamptz()
  updatedAt      DateTime     @map("updated_at")      @updatedAt @db.Timestamptz()
  deletedAt      DateTime?    @map("deleted_at")      @db.Timestamptz()

  //             relation
  senderId       String       @map("sender_id")       @db.Uuid
  sender         User         @relation(name: "SentMessage", fields: [senderId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  conversationId String       @map("conversation_id") @db.Uuid
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  messageIndex   Int @default(0)
  @@index([senderId])
  @@index([conversationId])
  @@index([createdAt])
  @@map("private_message")
}
