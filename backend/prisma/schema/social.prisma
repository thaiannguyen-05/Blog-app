model Post {
    id String @id @default(uuid()) @db.Uuid

    content String
    status  StatusPost @default(PUBLIC)

    urlImgs String[]

    userId String @db.Uuid
    user   User   @relation(name: "ownPosts", fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

    createAt DateTime  @default(now())
    updateAt DateTime  @updatedAt
    deleteAt DateTime?

    // relation
    comments Comment[]

    userLiked BehaviorWithPost[] @relation("userLiked")

    // Add indexes for better performance
    @@index([userId])
    @@index([createAt])
    @@index([status])
    @@index([userId, createAt])
}

model Comment {
    id      String @id @default(uuid()) @db.Uuid
    content String

    postId String @db.Uuid
    post   Post   @relation(fields: [postId], references: [id], onDelete: Cascade, onUpdate: Cascade)

    userId String @db.Uuid
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

    createAt DateTime @default(now())
    updateAt DateTime @updatedAt

    // relation
    repComments RepComment[]

    // Add indexes
    @@index([postId])
    @@index([userId])
    @@index([createAt])
}

model RepComment {
    id      String @id @default(uuid()) @db.Uuid
    content String

    createAt DateTime @default(now())
    updateAt DateTime @updatedAt

    senderID String @db.Uuid
    sender   User   @relation(fields: [senderID], references: [id], onDelete: Cascade, onUpdate: Cascade)

    commentId String  @db.Uuid
    comment   Comment @relation(fields: [commentId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model BehaviorWithPost {
    id String @id @default(uuid()) @db.Uuid

    isLiked Boolean @default(false)

    userId String @unique @db.Uuid
    user   User   @relation(name: "postLiked", fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

    postId String @unique @db.Uuid
    post   Post   @relation(name: "userLiked", fields: [postId], references: [id], onDelete: Cascade, onUpdate: Cascade)

    createdAt DateTime @default(now())
    updateAt  DateTime @updatedAt

    @@unique([userId, postId])
}

model blockedUser {
    id String @id @default(uuid()) @db.Uuid

    userId String @unique @db.Uuid
    user   User   @relation(name: "blackList", fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

    createdAt DateTime @default(now())
    updateAT  DateTime @updatedAt
}

enum StatusPost {
    PUBLIC
    PRIVATE
    ARCHIVE
}
